const{defineProperty:A}=Object;function b(B,C,_c){C in B?A(B,C,{value:_c,enumerable:!0,configurable:!0,writable:!0}):B[C]=_c;return B}function _(n){var s=n.match(/^(?:(\d+)\s+)?(.*?)((?:\s-[A-Za-z]+(?:=\S*)?)*)?$/),c=isNaN(a)?1:a,r=t(s[3]),o=r.get('l');if(s==null)return;var a=parseInt(s[1]);r.delete('l');return{name:s[2],quantity:c,language:o,customFlags:r}}function t(t){var n=new Map();if(!t)return n;var s=t.matchAll(/\s-([a-zA-Z]+)(?:=(\S*))?/g);s.forEach(t=>n.set(t[1],t[2]||'true'));return n}class Delayer{execute(e){let t;var s=new Promise(e=>t=e).then(()=>e());this.promiseResolveQueue.push({resolveFunc:t,promise:s});this.startQueueExecution();return s}startQueueExecution(){if(this.alreadyExecuting)return;this.alreadyExecuting=!0;this.executeNextInQueue()}executeNextInQueue(){if(this.promiseResolveQueue.length>0){var e=this.promiseResolveQueue.shift();if(e===void 0)throw Error('no element in promise queue');e.promise.then(()=>this.wait(this.delayMs)).then(()=>this.executeNextInQueue());e.resolveFunc(null)}else this.alreadyExecuting=!1}wait(e){return new Promise(t=>setTimeout(t,e))}constructor(e){b(this,'promiseResolveQueue',[]);b(this,'alreadyExecuting',!1);b(this,'delayMs',void 0);this.delayMs=e}}class ScryfallService{getCard(e){let t;if(this.uuidRegexp.test(e.name))t=`${this.SCRYFALL_API_URI}/cards/${e.name}`;else if(this.codeNumberRegexp.test(e.name)){let a=e.name;(e.language!=null&&this.validLanguages.includes(e.language))&&(a=e.name.split('/').slice(0,2).join('/')+`/${e.language}`);t=`${this.SCRYFALL_API_URI}/cards/${a}`}else t=`${this.SCRYFALL_API_URI}/cards/named/?fuzzy=${encodeURIComponent(e.name)}`;return this._callApi(t)}getCardPrintsFromCard(e,t=!1,a=!0){return this._getListFromApi(t?`${e.prints_search_uri}&include_multilingual=true`:e.prints_search_uri,e=>a?e.filter(e=>e.games.includes('paper')):e)}getCardsBatch(e){return Promise.all(e.map(e=>this.getCard(e)))}getCardsAndDo(e,t){var a=[];e.forEach(e=>{a.push(this.getCard({name:e.name,quantity:e.quantity,language:e.language,customFlags:e.customFlags}).then(a=>t(e,a)))});return Promise.all(a).then()}getCardPrintsAndDo(e,t,a=!1,r=!0){var n=[];e.forEach(e=>{n.push(this.getCard({name:e.name,quantity:e.quantity,language:e.language,customFlags:e.customFlags}).then(e=>e!==void 0?this.getCardPrintsFromCard(e,a,r):Promise.resolve(void 0)).then(a=>t(e,a)))});return Promise.all(n).then()}_getListFromApi(e,t){return this._callApi(e,e=>{if(e.has_more&&e.next_page!==void 0)return this._getListFromApi(e.next_page,t=>[...e.data,...t]).then(e=>{if(e!==void 0)return t(e)});return t(e.data)})}async _callApi(e,t=e=>e){var a=await this.delayer.execute(()=>fetch(e));if(a.ok)return a.json().then(t)}constructor(){b(this,'SCRYFALL_API_URI','https://api.scryfall.com');b(this,'API_DELAY_MS',100);b(this,'delayer',new Delayer(this.API_DELAY_MS));b(this,'uuidRegexp',/^[\da-f]{8}(?:-[\da-f]{4}){3}-[\da-f]{12}$/);b(this,'codeNumberRegexp',/^[\dA-Za-z]{3,5}\/[^/]+(?:\/(?:[A-Za-z]{2,3})?)?$/);b(this,'validLanguages',['en','es','fr','de','it','pt','ja','ko','ru','zhs','zht'])}}
